"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=Math.PI,b=m*2,S="close",c=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),u=(t,e,n)=>{if(n){const s=c(t,e),i=c(e,n),o=c(n,t);return Math.acos((s*s+i*i-o*o)/(2*s*i))}else return Math.atan2(e.y-t.y,e.x-t.x)},T=(t,e)=>{const n=e-t;return n>m&&n<b||n<0&&n>-m?-1:1};let x;const A=(t,e)=>{x=t.length;const n=t.map((s,i)=>{const o=t[(i-1+t.length)%t.length],l=t[(i+1)%t.length],d=c(s,l),a=c(o,s),z=E(o,s,l),_=1/Math.tan(z.main/2),y=e*_;return{...s,id:i,angles:z,vel:_,offset:y,radius:{size:e,x:s.x,y:s.y,hit:e},in:{x:s.x,y:s.y,length:a,rest:a},out:{x:s.x,y:s.y,length:d,rest:d},locked:!1,get prev(){return w(i,n)},get next(){return C(i,n)}}},[]);for(n.forEach(s=>{s.radius.hit=Math.min(s.out.length/(s.vel+s.next.vel),s.in.length/(s.vel+s.prev.vel))}),n.sort((s,i)=>s.radius.hit-i.radius.hit);x;)P(n[0],n,e),n.sort((s,i)=>s.locked&&!i.locked?1:!s.locked&&i.locked?-1:s.locked&&i.locked?0:s.radius.hit-i.radius.hit);return n.sort((s,i)=>s.id-i.id).forEach($),n},P=(t,e,n)=>{if(!t.locked){const s=e.find(o=>o.id===(t.id-1+e.length)%e.length),i=e.find(o=>o.id===(t.id+1)%e.length);if(n>=t.radius.hit)if(t.radius.hit===i.radius.hit){const o=e.find(a=>a.id===(s.id-1+e.length)%e.length),l=e.find(a=>a.id===(i.id+1)%e.length),d=e.find(a=>a.id===(l.id+1)%e.length);t.radius.size=t.radius.hit,i.radius.size=t.radius.hit,i.locked=!0,t.locked=!0,x-=2,t.offset=t.radius.size*t.vel,i.offset=i.radius.size*i.vel,l.in.rest-=i.offset,i.out.rest-=i.offset,i.in.rest-=i.offset,i.in.rest-=t.offset,t.out.rest-=t.offset,t.in.rest-=t.offset,s.out.rest-=t.offset,l.radius.hit=Math.min(l.out.length/(l.vel+d.vel),l.in.rest/l.vel),s.radius.hit=Math.min(s.in.length/(s.vel+o.vel),s.out.rest/s.vel)}else if(t.radius.hit===s.radius.hit){const o=e.find(a=>a.id===(i.id+1)%e.length),l=e.find(a=>a.id===(s.id-1+e.length)%e.length),d=e.find(a=>a.id===(l.id-1+e.length)%e.length);t.radius.size=t.radius.hit,s.radius.size=t.radius.hit,t.locked=!0,s.locked=!0,x-=2,t.offset=t.radius.size*t.vel,s.offset=s.radius.size*s.vel,l.out.rest-=s.offset,s.in.rest-=s.offset,s.out.rest-=s.offset,s.out.rest-=t.offset,t.in.rest-=t.offset,t.out.rest-=t.offset,i.in.rest-=t.offset,l.radius.hit=Math.min(l.in.length/(l.vel+d.vel),l.out.rest/l.vel),i.radius.hit=Math.min(i.out.length/(i.vel+o.vel),i.in.rest/i.vel)}else s.locked&&!i.locked&&(t.radius.size=Math.min(t.in.rest/t.vel,t.out.length/(t.vel+i.vel),t.radius.size)),i.locked&&!s.locked&&(t.radius.size=Math.min(t.out.rest/t.vel,t.in.length/(t.vel+s.vel),t.radius.size)),i.locked&&s.locked&&(t.radius.size=Math.min(t.in.rest/t.vel,t.out.rest/t.vel,t.radius.size)),t.offset=t.radius.size*t.vel,s.out.rest-=t.offset,t.in.rest-=t.offset,t.out.rest-=t.offset,i.in.rest-=t.offset,t.locked=!0,x--;else t.offset=t.radius.size*t.vel,s.out.rest-=t.offset,t.in.rest-=t.offset,t.out.rest-=t.offset,i.in.rest-=t.offset,t.locked=!0,x--}},$=t=>{const e=t.radius.size/Math.sin(t.angles.main/2);t.radius.x=t.x+Math.cos(t.angles.bis)*e,t.radius.y=t.y+Math.sin(t.angles.bis)*e,t.in.x=t.x+Math.cos(t.angles.prev)*t.offset,t.in.y=t.y+Math.sin(t.angles.prev)*t.offset,t.out.x=t.x+Math.cos(t.angles.next)*t.offset,t.out.y=t.y+Math.sin(t.angles.next)*t.offset},E=(t,e,n)=>{const s=u(t,e,n),i=u(e,t),o=u(e,n),l=T(i,o),d=i+l*s/2;return{main:s,next:o,prev:i,bis:d,dir:l}},w=(t,e)=>e[(t-1+e.length)%e.length],C=(t,e)=>e[(t+1)%e.length];let h,g,f;exports.ctx=void 0;exports.frame=0;exports.looping=!1;const F=(t,e,n)=>(f=document.createElement("canvas"),exports.ctx=f.getContext("2d"),document.body.prepend(f),f.setAttribute("id",n||"canvas"),t?(h=t,g=e||h,f.setAttribute("style",`width:${h}px;height:${g}px;`),f.setAttribute("width",h.toString()),f.setAttribute("height",g.toString())):(f.setAttribute("style","width:100%;height:100%;"),{width:h,height:g}=f.getBoundingClientRect(),f.setAttribute("width",h.toString()),f.setAttribute("height",g.toString())),exports.ctx.fillStyle="white",exports.ctx.strokeStyle="black",exports.ctx.imageSmoothingEnabled=!0,{width:h,height:g,ctx:exports.ctx,canvas:f});let k=!1;const I=t=>{t==="close"&&exports.ctx.closePath(),k?(k=!1,v()):exports.ctx.beginPath()},O=(t,e)=>{k?exports.ctx.lineTo(t,e):(k=!0,exports.ctx.moveTo(t,e))},q=(t,e,n,s,i)=>{exports.ctx.arcTo(t,e,n,s,i)},L=(t,e,n,s)=>{exports.ctx.beginPath(),exports.ctx.moveTo(t,e),exports.ctx.lineTo(n,s),v()},R=(t,e,n=10)=>{exports.ctx.beginPath(),exports.ctx.arc(t,e,n,0,b),v()},U=(t,e,n=20,s=20,i)=>{exports.ctx.beginPath(),i?(exports.ctx.moveTo(t+i,e),exports.ctx.arcTo(t+n,e,t+n,e+s,i),exports.ctx.arcTo(t+n,e+s,t,e+s,i),exports.ctx.arcTo(t,e+s,t,e,i),exports.ctx.arcTo(t,e,t+n,e,i)):exports.ctx.rect(t,e,n,s),v()},j=(t,e,n)=>{let s="",i=n||"",o=e||"sans-serif";if(typeof t=="number"&&(s=t.toString()+"px"),typeof t=="string"){const l=t.match(/^(\d+)([a-z%]*)\/?(\d*)([a-z%]*)$/);l&&(s=l[1],s+=l[2]?l[2]:"px",l[3]&&(s+=`/${l[3]}`,s+=l[4]?l[4]:"px"))}exports.ctx.font=`${i} ${s} ${o}`.trim()};let r;const W=(t,e,n)=>{exports.ctx.textAlign=t||"start",exports.ctx.textBaseline=e||"alphabetic",r=n},B=(t,e,n,s)=>{exports.ctx.fillText(t,e,n,s||r),exports.ctx.strokeText(t,e,n,s||r)},v=()=>{exports.ctx.fill(),exports.ctx.stroke()},D=t=>{t===null?exports.ctx.fillStyle="transparent":exports.ctx.fillStyle=t},G=(t,e)=>{t===null?exports.ctx.strokeStyle="transparent":exports.ctx.strokeStyle=t,e!==void 0&&(exports.ctx.lineWidth=e)},H=(t=0,e=0,n=h,s=g)=>{exports.ctx.clearRect(t,e,n,s)};let M;exports.stop=void 0;const J=t=>{exports.looping=!0;let e;M=()=>{exports.frame++,t(),e=requestAnimationFrame(M)},exports.stop=()=>{exports.looping=!1,cancelAnimationFrame(e)},M()};exports.CLOSE=S;exports.PI=m;exports.TAU=b;exports.arc=q;exports.circle=R;exports.clear=H;exports.draw=v;exports.fill=D;exports.font=j;exports.getcanvas=F;exports.line=L;exports.loop=J;exports.rect=U;exports.round_shape=A;exports.settext=W;exports.shape=I;exports.stroke=G;exports.text=B;exports.vertex=O;
